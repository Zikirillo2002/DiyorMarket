
@{
    ViewData["Title"] = "Upload";
}

<h1>Upload customers</h1>
<form asp-action="upload" method="post" enctype="multipart/form-data">
    <input class="form-control" type="file" id="formFile" name="file" accept=".xls, .xlsx" />
    <button class="btn btn-success " type="submit">
        Save Data
    </button>
</form>

<div>
    <ejs-grid id="categories-list"
              dataSource="@ViewBag.Customers"
              gridLines="Vertical"
              toolbar="@(new List<string>() { "Add", "Edit", "Delete", "Cancel", "Update" })" load="load">
        <e-grid-editsettings allowAdding="true" allowDeleting="true" allowEditing="true" mode="Normal">
        </e-grid-editsettings>
        <e-grid-columns>
            <e-grid-column headerText="FullName" field="FullName" typeof="text" class="customer-name"></e-grid-column>
            <e-grid-column headerText="Phonenumber" field="PhoneNumber" typeof="text" class="phone-number"></e-grid-column>
        </e-grid-columns>
    </ejs-grid>
</div>

<script>
    function load(args) {
        this.columns[0].validationRules = { required: true, minLength: [nameValidation, 'Name should be at least 3 letters'] };
        this.columns[1].validationRules = { required: true, format: [phoneValidation, 'Phone number should have following format: +998 ## ###-##-##'] };
    }

    function nameValidation(args) {
        return args['value'].length >= 3;
    };

    function phoneValidation(args) {
        const phone = args['value'].toString();
        
        if (!phone.startsWith('+')) {
            return false;
        }

        if (phone.length > 13) {
            return false;
        }

        return true;
    };

    // TODO: Get custom error message using method
    // function getPhoneValidationError(args) {
    //     const phone = args['value'].toString();

    //     if (!phone.startsWith('+')) {
    //         return 'Phone number should start with: "+"';
    //     }

    //     if (phone.length > 13) {
    //         return "Phone number must have 13 numbers.";
    //     }

    //     return "";
    // }
</script>
